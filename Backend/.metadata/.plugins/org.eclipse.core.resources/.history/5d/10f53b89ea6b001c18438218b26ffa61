package com.coforge.training.airline.serviceImpl;

import java.text.SimpleDateFormat;
import java.util.Date;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.coforge.training.airline.model.BookTickets;
import com.coforge.training.airline.model.PaymentStatus;
import com.coforge.training.airline.random.RandomNoGenerator;
import com.coforge.training.airline.repository.AdminContentRepo;
import com.coforge.training.airline.repository.BookTicketsRepo;
import com.coforge.training.airline.repository.FlightRepo;
import com.coforge.training.airline.repository.UserRepo;
import com.coforge.training.airline.response.BookTicketSaveResponse;
import com.coforge.training.airline.service.BookTicketService;

@Service
public class BookTicketServiceImpl implements BookTicketService
{

	@Autowired
	private BookTicketsRepo repo;

	@Autowired
	private FlightRepo flightRepo;
	
	@Autowired
	private AdminContentRepo adminRepo;
	
	@Autowired
	private UserRepo userRepo;
	
	@Override
	public BookTicketSaveResponse saveBookTicket(BookTickets ticket) {
		// TODO Auto-generated method stub
		
		BookTicketSaveResponse res=new BookTicketSaveResponse();
		
		if(userRepo.existsById(ticket.getBookid()) && userRepo.existsByEmail(ticket.getEmail()))
		{
			if(flightRepo.existsById(ticket.getFlightid()))
			{
//				set Total No of Seats
				int totalNoOfSeats=ticket.getBookseats().size();
				ticket.setTotalnoofseats(totalNoOfSeats);
				
//				Set Booking Time
				SimpleDateFormat timeFormat = new SimpleDateFormat("HH:mm:ss");
				Date time = new Date();
				
				ticket.setBookingtime(timeFormat.format(time));
				
//				Set Booking Date
				SimpleDateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy");
				Date date = new Date();
				
				ticket.setBookingdate(dateFormat.format(date));
				
				RandomNoGenerator rand=new RandomNoGenerator();
				
				long random=rand.getRamdomNumber();
				
				ticket.setBookid(random);
				
//				Set Book Id in PaymentStatus
				PaymentStatus status=ticket.getPaymentstatus();
				
				status.setBookid(random);
				
				ticket.setPaymentstatus(status);
				
				
				
			}
			else
			{
				res.setMessage("This Flight is not exist");
				res.setCheck(false);
			}
		}
		else
		{
			res.setMessage("User is Incorrect");
			res.setCheck(false);
			res.setBookticket(ticket);
		}
		
		return res;
	}
	
}
