package com.coforge.training.airline.serviceImpl;

import java.util.Date;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;

import com.coforge.training.airline.enums.rolesEnums;
import com.coforge.training.airline.model.Address;
import com.coforge.training.airline.model.AdminContent;
import com.coforge.training.airline.model.Passport;
import com.coforge.training.airline.model.User;
import com.coforge.training.airline.repository.AdminContentRepo;
import com.coforge.training.airline.repository.UserRepo;
import com.coforge.training.airline.request.RegisterUserRequest;
import com.coforge.training.airline.response.RegisterNewUser;
import com.coforge.training.airline.service.LoginService;

@Service
public class LoginServiceImpl implements LoginService{

	@Autowired
	private UserRepo repo;

	@Autowired
	private AdminContentRepo adminrepo;
	
	
	@Override
	public RegisterNewUser registerNewUser(RegisterUserRequest registerUser) {
		RegisterNewUser res=new RegisterNewUser();
		
//		User user=new User();
		
		if(!repo.existsByEmail(registerUser.getEmail()))
		{
			User user=new User();
			if(adminrepo.existsById(registerUser.getEmail()))
			{
				System.out.println("admin");
				user.setEmail(registerUser.getEmail());
				user.setFirstname(registerUser.getFirstname());
				user.setLastname(registerUser.getLastname());
				user.setMobileno(registerUser.getMobileno());
				user.setPassword(registerUser.getPassword());
				
				user.setRole(rolesEnums.Admin);
				user.setJoindate(new Date());
				user.setAvatar("https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/User-avatar.svg/1024px-User-avatar.svg.png");
				user.setCompleteprofile(false);
				user.setAddress(null);
				user.setPassport(null);
				
				User saveuser=repo.save(user);
				res.setMessage("User is Register");
				res.setEmail(registerUser.getEmail());
				res.setUser(saveuser);
			}
			if(!adminrepo.existsById(registerUser.getEmail()))
			{
				System.out.println("normal user");
				user.setEmail(registerUser.getEmail());
				user.setFirstname(registerUser.getFirstname());
				user.setLastname(registerUser.getLastname());
				user.setMobileno(registerUser.getMobileno());
				user.setPassword(registerUser.getPassword());
				
				user.setRole(rolesEnums.Normal_User);
				user.setJoindate(new Date());
				user.setAvatar("https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/User-avatar.svg/1024px-User-avatar.svg.png");
				user.setCompleteprofile(false);
				user.setAddress(new Address());
				user.setPassport(new Passport());
				
				User saveuser=repo.save(user);
				res.setMessage("User is Register");
				res.setEmail(registerUser.getEmail());
				res.setUser(saveuser);
			}
		}
		else
		{
			res.setMessage("User is Already Exist");
			res.setEmail(registerUser.getEmail());
		}
		
		return res;
	}
	
}
